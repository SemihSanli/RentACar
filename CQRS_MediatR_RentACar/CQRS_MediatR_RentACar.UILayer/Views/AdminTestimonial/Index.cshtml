@model List<GetTestimonialQueryResult>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}




<div class="container-fluid px-4 py-3">
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h1 class="h5 mb-0">Görüşler (@(Model?.Count ?? 0))</h1>
		<a class="btn btn-primary" href="@Url.Action("Create","AdminTestimonial")">
			<i class="fas fa-plus me-2"></i>Yeni Görüş
		</a>
	</div>

	@if (Model == null || !Model.Any())
	{
		<div class="alert alert-info mb-0">Kayıt bulunamadı.</div>
	}
	else
	{
		<div class="row g-4">
			@foreach (var t in Model)
			{
				<div class="col-12 col-md-6 col-xl-4">
					<div class="card h-100 shadow-sm border-0 testimonial-card">
						<div class="card-body d-flex gap-3">
							<!-- Circle avatar -->
							<div class="avatar-outer">
								@if (!string.IsNullOrWhiteSpace(t.TestimonialImageURL))
								{
									<img src="@t.TestimonialImageURL"
										 alt="@t.TestimonialName"
										 class="avatar-img"
										 loading="lazy"
										 referrerpolicy="no-referrer" />
								}
								else
								{
									<div class="avatar-fallback">
										<i class="fas fa-user text-muted"></i>
									</div>
								}
							</div>

							<div class="flex-grow-1">
								<div class="d-flex justify-content-between align-items-start">
									<div>
										<h6 class="mb-0">@t.TestimonialName</h6>
										<small class="text-muted">@t.TestimonialTitle</small>
									</div>
									<!-- Review score as stars if numeric, else badge -->
									@{
										bool parsed = decimal.TryParse(t.TestimonialReviewScore, System.Globalization.NumberStyles.Any, System.Globalization.CultureInfo.InvariantCulture, out var score);
										var safeScore = parsed ? Math.Max(0, Math.Min(5, (double)score)) : 0;
										int full = (int)Math.Floor(safeScore);
										bool half = safeScore - full >= 0.5;
									}
									<div class="ms-2 text-warning small">
										@if (parsed)
										{
											for (int i = 0; i < full; i++) { <i class="fas fa-star"></i> }
											@if (half) { <i class="fas fa-star-half-alt"></i> }
											@for (int i = full + (half ? 1 : 0); i < 5; i++) { <i class="far fa-star"></i> }
										}
										else
										{
											<span class="badge bg-light text-dark">@t.TestimonialReviewScore</span>
										}
									</div>
								</div>

								<p class="mt-2 mb-0 clamp-3">@t.TestimonialComment</p>
							</div>
						</div>

						<div class="card-footer bg-white border-0 pt-0">
							<div class="d-flex justify-content-end gap-2">
								<a class="btn btn-outline-primary btn-sm" href="@Url.Action("UpdateTestimonial","AdminTestimonial", new { id = t.TestimonialID })">
									<i class="fas fa-edit me-1"></i>Güncelle
								</a>
								<a class="btn btn-outline-danger btn-sm"
								   href="@Url.Action("Delete","AdminTestimonial", new { id = t.TestimonialID })"
								   onclick="return confirm('Bu kaydı silmek istediğinize emin misiniz?');">
									<i class="fas fa-trash me-1"></i>Sil
								</a>
							</div>
						</div>
					</div>
				</div>
			}
		</div>
	}
	<style>
		/* Circle avatar */
		.avatar-outer {
			flex: 0 0 auto;
			width: 84px;
			height: 84px;
			border-radius: 50%;
			overflow: hidden;
			background: #f3f4f6;
			box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
			display: grid;
			place-items: center;
		}

		.avatar-img {
			width: 100%;
			height: 100%;
			object-fit: cover;
			object-position: center;
			display: block;
		}

		.avatar-fallback {
			width: 100%;
			height: 100%;
			display: grid;
			place-items: center;
			font-size: 32px;
		}

		/* Card polish */
		.testimonial-card {
			border-radius: 14px;
			transition: box-shadow .25s ease, transform .25s ease;
		}

			.testimonial-card:hover {
				transform: translateY(-2px);
				box-shadow: 0 12px 28px rgba(0,0,0,.10);
			}

		/* Clamp long comments */
		.clamp-3 {
			display: -webkit-box;
			-webkit-line-clamp: 3;
			-webkit-box-orient: vertical;
			overflow: hidden;
		}

		@@media (max-width: 576px) {
			.avatar-outer

		{
			width: 72px;
			height: 72px;
		}

		}
	</style>
</div>



@section Scripts{
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
}
